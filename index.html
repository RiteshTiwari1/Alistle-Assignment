<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Electrician Allocation System</title>
  <link rel="stylesheet" type="text/css" href="index.css">

</head>
<body>
  <div class="container">
    <h1>Electrician Allocation System</h1>

    <button class="assign-button" onclick="autoAssign()">Auto Assign Electricians</button>

    <div class="form-group">
      
      <input type="text" id="PersonName" name="PersonName" placeholder="Person Name">
    </div>

    <button class="date-change-button" onclick="dateChange()">Date Change</button>
  </div>


  <script>
    const electricians = [
    {name:"Digvijay",phone:"6161232524",zone:[],"griveianceElectrician":true},{name:"Pranav",phone:"6161232524",zone:[],"griveianceElectrician":true},{name:"Sidharth",phone:"6161232524",zone:["NOIDA","GHAZIABAD"],"griveianceElectrician":false},{name:"Javed",phone:"6161232524",zone:["GURGAON"],"griveianceElectrician":false}
    ];

    const sites = [
{ name: "Manthan ", phone: "6163988877", city: "GREATER NOIDA", AssignedElectrician: [], InstallationDate: "2023-10-06T00:00:00.000Z", grievance: false }, { name: "Samrat Jain ", phone: "6163988877", city: "GHAZIABAD", AssignedElectrician: [], InstallationDate: "2023-03-07T00:00:00.000Z", grievance: false }, { name: "Abhimanu Jaiswal ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-10-14T00:00:00.000Z", grievance: true }, { name: "Abhinav Tambi (3rd Floor) ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-12-15T00:00:00.000Z", grievance: false }, { name: "Abhinav Tambi (2nd Floor) ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-12-15T00:00:00.000Z", grievance: false }, { name: "Avi Arora", phone: "6163988877", city: "NOIDA", AssignedElectrician: [], InstallationDate: "2023-03-01T00:00:00.000Z", grievance: true }, { name: "Mukul Rathi", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-08-04T00:00:00.000Z", grievance: false }, { name: "Pankaj Khatri", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-10-18T00:00:00.000Z", grievance: false }, { name: "Abhinav Tambi (4RTH Floor) ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-12-15T00:00:00.000Z", grievance: true }, { name: "Mohit Garg ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-12-08T00:00:00.000Z", grievance: false }, { name: "PRATEEK  ", phone: "6163988877", city: "NOIDA", AssignedElectrician: [], InstallationDate: "2023-03-02T00:00:00.000Z", grievance: false }, { name: "Ishaan ", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-09-15T00:00:00.000Z", grievance: true }, { name: "Official Ronnie Hunk ", phone: "6163988877", city: "GHAZIABAD", AssignedElectrician: [], InstallationDate: "2023-11-15T00:00:00.000Z", grievance: false }, { name: "AARYA MOTORS ", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-08-17T00:00:00.000Z", grievance: false }, { name: "Utkarsh ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-03-07T00:00:00.000Z", grievance: true }, { name: "Vijesh Wadhwa ", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-10-22T00:00:00.000Z", grievance: false }, { name: "Shahzama ", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-12-19T00:00:00.000Z", grievance: false }, { name: "aartstore  ", phone: "6163988877", city: "ANY FOR NOW", AssignedElectrician: [], InstallationDate: "2023-03-05T00:00:00.000Z", grievance: true }, { name: "Sameer ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-10-20T00:00:00.000Z", grievance: false }, { name: "Anuj Pandey ", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-03-17T00:00:00.000Z", grievance: false }, { name: "Randeep Reehal ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-03-15T00:00:00.000Z", grievance: true }, { name: "Harsh Bansal ", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-03-03T00:00:00.000Z", grievance: false }, { name: "neha05singh  ", phone: "6163988877", city: "ANY FOR NOW", AssignedElectrician: [], InstallationDate: "2023-03-02T00:00:00.000Z", grievance: false }, { name: "pujapunj9  ", phone: "6163988877", city: "ANY FOR NOW", AssignedElectrician: [], InstallationDate: "2023-03-18T00:00:00.000Z", grievance: true }, { name: "  Divanshu Arora ", phone: "6163988877", city: "ANY FOR NOW", AssignedElectrician: [], InstallationDate: "2023-02-28T15:00:23.292Z", grievance: false }, { name: "Sushil Flock Coliving", phone: "6163988877", city: "GURGAON", AssignedElectrician: [], InstallationDate: "2023-03-03T02:36:48.624Z", grievance: false }, { name: "Yogesh Agarwal ", phone: "6163988877", city: "NOIDA", AssignedElectrician: [], InstallationDate: "2023-07-24T00:00:00.000Z", grievance: true }, { name: "MLKR Pvt. Ltd (ref 2) ", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-09-10T00:00:00.000Z", grievance: false }, { name: "KRISHNA ROY", phone: "6163988877", city: "DELHI", AssignedElectrician: [], InstallationDate: "2023-01-04T00:00:00.000Z", grievance: false }, { name: "Anuj Gupta  ", phone: "6163988877", city: "NOIDA", AssignedElectrician: [], InstallationDate: "2023-10-18T00:00:00.000Z", grievance: true }
   
    ];  
    // console.log(sites.length);
    electricians.forEach(electrician => {
      electrician.capacity = 0;
    });

  
    function dateChange() {
  
  var personNameValue = document.getElementById('PersonName').value;
      console.log(personNameValue);
  const currentDate = new Date().toISOString(); // Get current date and time

  // console.log(typeof personNameValue);
  
  const matchingSite = sites.find(site => {
  
  const siteNameWithoutSpaces = site.name.trim();
  const personNameWithoutSpaces = personNameValue.trim();

  if (siteNameWithoutSpaces === personNameWithoutSpaces) {
    console.log('Found:', site.name);
    return site;
  }
});

  console.log(matchingSite);

  if (matchingSite) {
    
    matchingSite.InstallationDate = currentDate;
    console.log('Updated InstallationDate for', personNameValue, 'to', currentDate);
  } else {
    console.log('Person not found in sites array');
  }

  // console.log(sites);
}


    function autoAssign() {
      const currentDate = new Date().toISOString().split('T')[0]; // Get current date

      
      
      let counter=0;
      sites.forEach(site =>{
        // console.log(site.InstallationDate);
        if(site.InstallationDate.split('T')[0] === currentDate){
          counter++;
        }

        
      });

      console.log(counter);

      let totalnumber = counter / 4;
      totalnumber=Math.min(totalnumber,3);

      console.log(totalnumber);
      let visited= new Set();
      sites.forEach(site => {

        // console.log(site.installationDate);
        if (!visited.has(site.name) &&  site.grievance===true && site.InstallationDate.split('T')[0] === currentDate) {
          electricians.forEach(electricians => {
              if(!visited.has(site) && electricians.griveianceElectrician === true &&electricians.capacity<totalnumber){
                site.AssignedElectrician.push({
                  electricianName: electricians.name,
                  electricianAssignDate: currentDate
                });
                electricians.capacity++;
                counter --;
                visited.add(site.name);
              }
          });
        }
      });
      
  sites.forEach(site => {

// console.log(site.installationDate);
    if (!visited.has(site.name) &&  site.grievance===false && site.InstallationDate.split('T')[0] === currentDate) {
      electricians.forEach(electricians => {
          if(!visited.has(site) && electricians.griveianceElectrician === false &&electricians.capacity<totalnumber){
            site.AssignedElectrician.push({
              electricianName: electricians.name,
              electricianAssignDate: currentDate
            });
            electricians.capacity++;
            counter --;
            visited.add(site.name);
          }
      });
    }
  });
      
  sites.forEach(site => {

// console.log(site.installationDate);
    if (!visited.has(site.name) && site.InstallationDate.split('T')[0] === currentDate) {
      electricians.forEach(electricians => {
          if(!visited.has(site) && electricians.capacity<totalnumber){
            site.AssignedElectrician.push({
              electricianName: electricians.name,
              electricianAssignDate: currentDate
            });
            electricians.capacity++;
            counter --;
            visited.add(site.name);
          }
      });
    }
  });
      
      console.log(sites);
      console.log(electricians);

      if(counter!=0){
        console.log(counter);
        console.log("data is huge");
      }
    }
  </script>
</body>
</html>